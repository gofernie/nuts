---
const { title, staticUrl, iframeUrl } = Astro.props;
---
<div class="map-ctn" data-iframe={iframeUrl} role="button" aria-label={`Open map of ${title}`} tabindex="0">
  <img src={staticUrl} alt="" loading="lazy" decoding="async" width="1200" height="600" />
  <div class="overlay">Click to load map</div>
</div>

<style>
.map-ctn{ position:relative; aspect-ratio:2/1; border:1px solid #eee; border-radius:12px; overflow:hidden; box-shadow:0 1px 6px rgba(0,0,0,.1); }
.map-ctn > img{ width:100%; height:100%; object-fit:cover; display:block; }
.overlay{ position:absolute; inset:auto 12px 12px 12px; display:inline-block; background:#111827; color:#fff; padding:10px 14px; border-radius:999px; font-weight:600; }
.map-ctn.loading .overlay{ display:none; }
</style>

<script>
const root = document.currentScript.closest('.map-ctn');
function load(){
  if(root.classList.contains('loading')) return;
  root.classList.add('loading');
  const src = root.dataset.iframe;
  const iframe = document.createElement('iframe');
  iframe.src = src;
  iframe.loading = 'eager';
  iframe.referrerPolicy = 'no-referrer-when-downgrade';
  iframe.allowFullscreen = true;
  Object.assign(iframe.style, { position:'absolute', inset:'0', width:'100%', height:'100%', border:'0' });
  root.appendChild(iframe);
}
root.addEventListener('click', load);
root.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); load(); }});
</script>
