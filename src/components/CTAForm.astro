---
export interface Props {
  formId: string;
  pageSlug?: string;
  pageTitle?: string;   // Activity (e.g., "skiing and boarding")
  spare_1?: string;     // BG image for the copy panel (left)
  spare_1_pos?: string; // optional CSS background-position (e.g., "center 30%")
}

const {
  formId,
  pageSlug = "",
  pageTitle = "spending time",
  spare_1 = "",
  spare_1_pos = "center center",
} = Astro.props;

// Pretty title
const base = (pageTitle ?? "spending time").toString().trim();
const prettyTitle = base
  ? base.charAt(0).toUpperCase() + base.slice(1).toLowerCase()
  : "Spending time";

// Personas
type Persona = { name: string; email: string; notes?: string };
const personas: Record<string, Persona> = {
  Snowmobiling: { name: "Sled-Head Sam", email: "powdersledder@example.com", notes: "pow stashes, groomed trails" },
  Snowboarding: { name: "Pow Chaser", email: "pow-chaser@example.com", notes: "steeps, trees, sidecountry" },
  Skiing:       { name: "First-Chair Fran", email: "firstchair@example.com", notes: "early laps, quiet runs" },
  Biking:       { name: "Singletrack Pat", email: "trailtime@example.com", notes: "flow + technical mix" },
  Rafting:      { name: "River Runner", email: "splashcrew@example.com", notes: "class II/III, sunny days" },
  Hiking:       { name: "Summit Seeker", email: "highline@example.com" },
};
const persona: Persona = personas[prettyTitle] ?? {
  name: `${prettyTitle} fan`,
  email: `${prettyTitle.toLowerCase().replace(/\s+/g, "-")}-fan@example.com`,
};

const fanTag = `For ${prettyTitle} fans`;

// Copy panel background
const copyBg = (spare_1 ?? "").toString().trim();
const copyStyle = copyBg
  ? `background-image: linear-gradient(rgba(0,0,0,.80), rgba(0,0,0,.58)), url('${copyBg}');
     background-position: ${spare_1_pos};`
  : "";
---

<section class="cta" data-activity={prettyTitle}>
  <!-- LEFT: copy with image -->
  <div class="cta__text" style={copyStyle}>
    <div class="cta__text-inner">
      <h2 class="cta__title">
        Love {prettyTitle} in Fernie?<br />Maybe it's time to move here.
      </h2><br>
      <p class="cta__tag">{fanTag} ✳</p>

      <p class="cta__intro">
        If you love it here, why not make it part of your life?
        Get a curated list of homes near the places where you actually want to be —
        trails, lifts, rivers, patios, and everything in between.
      </p>
      <ul class="cta__list">
        <li>• Local homes close to what you love</li>
        <li>• No spam — just hand-picked listings</li>
        <li>• Simple, friendly guidance</li>
        <li>• {prettyTitle} dreams</li>
      </ul>
    </div>
  </div>

  <!-- RIGHT: neutral form -->
  <form action={`https://formspree.io/${formId}`} method="POST" class="cta__form">
    <input type="hidden" name="page_slug" value={pageSlug} />
    <input type="hidden" name="page_title" value={base} />
    <input type="hidden" name="activity" value={prettyTitle} />
    <input type="hidden" name="cta_variant" value="activity-themed-persona-v1" />
    <input type="hidden" name="_subject" value={`Fernie Quiet List • ${prettyTitle}`} />

    <div class="fld">
      <label for="name">Name</label>
      <input id="name" name="name" placeholder={persona.name} required />
    </div>

    <div class="fld">
      <label for="email">Email</label>
      <input id="email" name="email" type="email" placeholder={persona.email} required />
    </div>

    <div class="fld">
      <label for="budget">Budget (approx.)</label>
      <input id="budget" name="budget" placeholder="$700k – $900k" />
    </div>

    <div class="fld">
      <label for="beds">Beds</label>
      <input id="beds" name="beds" placeholder="2+" />
    </div>

    <div class="fld fld--full">
      <label for="timing">When are you thinking?</label>
      <select id="timing" name="timing">
        <option value="">Select…</option>
        <option>Soon (0–3 months)</option>
        <option>3–6 months</option>
        <option>6–12 months</option>
        <option>Just browsing / curious</option>
      </select>
    </div>

    <div class="fld fld--full">
      <label for="notes">Anything specific?</label>
      <textarea
        id="notes"
        name="notes"
        rows="3"
        placeholder={personas[prettyTitle]?.notes
          ? `e.g., ${personas[prettyTitle]?.notes}`
          : "e.g., walkable, quiet street, rental-friendly"}
      ></textarea>
    </div>

    <button type="submit" class="cta__btn">Get my quiet list →</button>
  </form>

  <style>
    /* Container */
    .cta {
      width: 100%;
      max-width: var(--site-max, 1300px);
      margin: 3rem auto;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      background: #fff;
      box-shadow: 0 8px 24px rgba(0,0,0,.05);
      display: grid;
      grid-template-columns: 1fr;
      overflow: hidden;
    }
    @media (min-width: 900px) {
      .cta { grid-template-columns: 1fr 1fr; }
    }

    /* LEFT: copy w/ image */
    .cta__text {
      position: relative;
      background: #0d0d0d; /* behind letterboxing */
      background-size: 150% auto;       /* <-- show MORE of the image */
      background-repeat: no-repeat;
      background-position: center !important;
      color: #fff;
      min-height: 420px;               /* keeps image visible even w/ short copy */
      display: flex;
      align-items: center;             /* center vertically */
    }
    /* On phones, use cover for immersive feel */
    @media (max-width: 899px) {
      .cta__text { background-size: cover; }
    }

    .cta__text-inner {
      padding: 2rem;
      width: 100%;
      max-width: 680px;
    }

    .cta__title { font-size: clamp(28px, 2.3vw, 3px); font-weight: 600; line-height: 1.25; margin: 0 0 .35rem; color:#fff; }
    .cta__tag   { margin: 0 0 .9rem; font-size: .95rem; color: rgba(255,255,255,.95); }
    .cta__intro { font-weight: 555;margin: 0 0 1rem; font-size: 1rem; line-height: 1.65; color: rgba(255,255,255,.95); }
    .cta__list  { font-weight: 500;margin: 0; padding: 0; list-style: none; color: rgba(255,255,255,.95); font-size: .95rem; }
    .cta__list li { margin: .38rem 0; }

    /* RIGHT: form panel */
    .cta__form {
      background: #f8f9fb;
      padding: 1.25rem;
      border-left: 1px solid #e9eaef;
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }
    @media (min-width: 700px) {
      .cta__form { grid-template-columns: 1fr 1fr; }
    }

    .fld { display: flex; flex-direction: column; min-width: 0; }
    .fld--full { grid-column: 1 / -1; }
    .fld label { font-weight: 600; font-size: .92rem; margin-bottom: .32rem; color: #333; }

    .fld input,
    .fld select,
    .fld textarea {
      padding: .62rem .72rem;
      border: 1px solid #cfd4dc;
      border-radius: 8px;
      font-size: .96rem;
      line-height: 1.35;
      background: #fff;
      width: 100%;
      box-sizing: border-box;
      outline: none;
    }
    .fld input:focus,
    .fld select:focus,
    .fld textarea:focus {
      border-color: #111;
      box-shadow: 0 0 0 2px rgba(0,0,0,.08);
    }

    .cta__btn {
      grid-column: 1 / -1;
      background: #111;
      color: #fff;
      padding: .9rem 1rem;
      font-size: 1rem;
      font-weight: 700;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background .2s ease;
      width: 100%;
    }
    .cta__btn:hover { background: #222; }

    /* Mobile: stack divider */
    @media (max-width: 899px) {
      .cta__form { border-left: none; border-top: 1px solid #e9eaef; }
    }
  </style>
</section>
