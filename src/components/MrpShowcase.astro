---
// File: src/components/MrpShowcase.astro
// Usage: <MrpShowcase />
const EMBED_SRC = "https://idx.myrealpage.com/wps/rest/64196/l/showcase/v2/129176/in.js";
---

<div id="mrp-card-wrap" class="mrp-card-wrap">
  <script src={EMBED_SRC} async id="mrp-showcase-script-129176"></script>
</div>

<style>
  /* === Your sitewide card look (scoped to wrapper) === */
  .mrp-card-wrap{
    --card-radius: 1rem;
    --card-shadow: 0 6px 18px rgba(0,0,0,.08);
    --card-bg: #fff;
    --card-gap: .75rem;
    --text-900:#111;
    --text-600:#555;
    --text-400:#7a7a7a;
    --chip-bg:#f5f7fb;
    --chip-text:#223;
    position: relative;
    border-radius: var(--card-radius);
    background: var(--card-bg);
    box-shadow: var(--card-shadow);
    padding: 1rem; /* If you want edge-to-edge images, you can remove this */
  }

  /* Make internal grids look like your card grid if MRP injects raw markup */
  .mrp-card-wrap :where(ul,ol){
    list-style: none;
    margin: 0;
    padding: 0;
  }

  /* A flexible “unknown markup” grid that catches most list/tiles */
  .mrp-card-wrap :where(.mrp-showcase,.mrp-results,.mrp-list,.mrp-grid,[class*="grid"],[class*="results"],[id*="results"]) {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 1rem;
  }

  /* Individual cards: catch-all selector set */
  .mrp-card-wrap :where(
    .mrp-listing,
    .mrp-card,
    .mrp-item,
    li[class*="listing"],
    div[class*="listing"],
    [data-mls],
    [class*="result"]
  ){
    display: flex;
    flex-direction: column;
    gap: var(--card-gap);
    border-radius: var(--card-radius);
    background: #fff;
    overflow: hidden;
    box-shadow: var(--card-shadow);
  }

  /* Images */
  .mrp-card-wrap :where(img, .thumb, .photo, [class*="image"]) img{
    width: 100%;
    height: 200px;
    object-fit: cover;
    display: block;
  }

  /* Title / price / meta normalization */
  .mrp-card-wrap :where(h1,h2,h3,h4){
    font-size: 1rem;
    line-height: 1.2;
    margin: 0;
    color: var(--text-900);
  }
  .mrp-card-wrap :where(.price, [class*="price"]){
    font-weight: 700;
    font-size: 1.05rem;
    color: var(--text-900);
  }
  .mrp-card-wrap :where(.addr, .address, [class*="address"], [data-field="address"]){
    color: var(--text-600);
    font-size: .95rem;
  }
  .mrp-card-wrap :where(.meta, .details, .facts, [class*="beds"], [class*="baths"], [class*="sqft"]){
    display: flex;
    flex-wrap: wrap;
    gap: .5rem .75rem;
    font-size: .9rem;
    color: var(--text-400);
  }
  .mrp-card-wrap :where(.chip, .tag, .badge){
    background: var(--chip-bg);
    color: var(--chip-text);
    border-radius: 999px;
    padding: .25rem .5rem;
    font-size: .8rem;
  }

  /* Card padding for non-image sections */
  .mrp-card-wrap :where(.content, .body, .info, .mrp-card-body, [class*="content"]) {
    padding: .75rem .9rem 1rem;
    display: grid;
    gap: .5rem;
  }

  /* Buttons/links */
  .mrp-card-wrap :where(a, button){
    text-decoration: none;
  }
  .mrp-card-wrap :where(.btn, .button, a[class*="btn"]){
    display: inline-block;
    border-radius: .75rem;
    padding: .5rem .8rem;
    font-weight: 600;
    border: 1px solid #e6e8ef;
  }

  /* Responsive if the embed is an iframe (we can only style the frame, not inside) */
  .mrp-card-wrap iframe{
    width: 100% !important;
    border: 0;
    border-radius: var(--card-radius);
    box-shadow: var(--card-shadow);
    display: block;
  }

  /* Optional: soft skeleton while widget loads */
  .mrp-card-wrap::before{
    content: "";
    position: absolute; inset: 0;
    border-radius: var(--card-radius);
    background: linear-gradient(90deg,#f6f7f8, #edeef1, #f6f7f8);
    background-size: 200% 100%;
    animation: mrpShimmer 1.2s infinite;
    opacity: .35;
    pointer-events: none;
    transition: opacity .3s ease;
  }
  .mrp-card-wrap.mrp-loaded::before{ opacity: 0; }
  @keyframes mrpShimmer { 0%{background-position: 200% 0} 100%{background-position: -200% 0} }
</style>

<script is:raw>
  // Minimal enhancer for “unknown” DOM: when the script injects content, mark loaded
  (function(){
    const wrap = document.getElementById('mrp-card-wrap');
    if(!wrap) return;

    // 1) If MRP uses an iframe, we can only prettify the frame itself.
    const iframeObserver = new MutationObserver(() => {
      const ifr = wrap.querySelector('iframe');
      if (ifr) {
        wrap.classList.add('mrp-loaded');
        // Some MRP widgets auto-height; if not, you can tweak here or let it scroll.
        // ifr.style.height = '100vh'; // example only
      }
    });

    // 2) If MRP injects raw markup, add utility classes to its items (best-effort)
    const contentObserver = new MutationObserver(() => {
      const items = wrap.querySelectorAll(
        '.mrp-listing, .mrp-card, .mrp-item, li[class*="listing"], div[class*="listing"], [data-mls], [class*="result"]'
      );
      if (items.length) {
        wrap.classList.add('mrp-loaded');
        // Add a .content wrapper if none exists (helps padding/typography)
        items.forEach(el => {
          const hasContent = el.querySelector('.content, .body, .info, .mrp-card-body, [class*="content"]');
          if (!hasContent) {
            const body = document.createElement('div');
            body.className = 'content';
            // Move non-image blocks into the content bucket (best-effort heuristic)
            [...el.children].forEach(child => {
              const tag = child.tagName.toLowerCase();
              const likelyImage = tag === 'img' || child.querySelector?.('img');
              if (!likelyImage && child !== body) body.appendChild(child);
            });
            el.appendChild(body);
          }
        });
      }
    });

    iframeObserver.observe(wrap, { childList: true, subtree: true });
    contentObserver.observe(wrap, { childList: true, subtree: true });

    // Safety: mark loaded after 5s even if nothing matched (prevents endless shimmer)
    setTimeout(()=>wrap.classList.add('mrp-loaded'), 5000);
  })();
</script>
