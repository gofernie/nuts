---
/* HeroBleed.astro — fix H1 clipping on narrow viewports */
export interface Props {
  src?: string;
  title?: string;
  alt?: string;
  height?: { min?: number; vh?: number; max?: number };
  gradient?: string;
  preload?: boolean;
  containerMax?: number;
  flush?: boolean;
  containerPad?: number;
}
const {
  src = "",
  title = "",
  alt = "",
  height = { min: 260, vh: 62, max: 680 },
  gradient = "linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,0) 55%)",
  preload = false,
  containerMax = 1200,
  flush = true,
  containerPad = 16,
} = Astro.props as Props;

const hMin = Number.isFinite(height?.min) ? height!.min : 260;
const hVh  = Number.isFinite(height?.vh)  ? height!.vh  : 42;
const hMax = Number.isFinite(height?.max) ? height!.max : 480;

const heightCss = `clamp(${hMin}px, ${hVh}svh, ${hMax}px)`;

/* ✅ Use CSS min()/max() so we never set a negative left on small screens */
const leftExpr = flush
  ? `max(0px, calc((100vw - ${containerMax}px)/2))`
  : `max(${containerPad}px, calc((100vw - ${containerMax}px)/2 + ${containerPad}px))`;

const widthExpr = flush
  ? `min(${containerMax}px, 100vw)`
  : `min(${containerMax - 2*containerPad}px, calc(100vw - ${2*containerPad}px))`;
---

{preload && src && (
  <Fragment slot="head">
    <link rel="preload" as="image" href={src} fetchpriority="high" />
  </Fragment>
)}

<section class="hb" data-hb style={`height:${heightCss}; --scrim:${gradient};`}>
  {src && (
    <img
      src={src}
      alt={alt}
      fetchpriority="high"
      loading="eager"
      decoding="async"
      width="2000"
      height="1000"
      class="hb__img"
    />
  )}
  <div class="hb__scrim" aria-hidden="true"></div>

  {title && (
    <h1 class="hb__pin" style={`left:${leftExpr}; width:${widthExpr};`}>
      {title}
    </h1>
  )}
</section>

<style>
  .hb {
    position: relative;
    isolation: isolate;
    left: 50%; right: 50%;
    margin-left: -50vw; margin-right: -50vw;
    width: 100vw; max-width: 100vw;
    overflow: hidden;
    background: #e5e7eb;
    display: block;
    margin-bottom: clamp(16px, 2.5vw, 24px);
  }
  .hb__img {
    width: 100%; height: 100%; display: block;
    object-fit: cover; object-position: center;
  }
  .hb__scrim {
    position: absolute; inset: 0; z-index: 10;
    background: var(--scrim);
  }
  .hb__pin {
    position: absolute; z-index: 20; margin: 0;
    bottom: clamp(16px, 3vw, 28px);
    pointer-events: none;

    color: #fff;
    font-weight: 700;
    line-height: 1.1;
    font-size: clamp(2rem, 5vw, 3rem);
    text-shadow: 0 2px 8px rgba(0,0,0,.45);
    text-align: left;
  }
</style>
