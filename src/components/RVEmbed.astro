---
// File: src/components/RVEmbed.astro
const {
  block,
  className = "",
  minHeight = "1000px",
  showSkeleton = true, // ðŸ†• control whether skeleton shimmer shows
} = Astro.props;

if (!block) {
  throw new Error("[RVEmbed] Missing block id");
}
---

<section class={`rv-wrap ${className}`} style={`min-height:${minHeight};`}>
  {showSkeleton && (
    <div class="rv-skel-grid" aria-hidden="true">
      <div class="rv-skel-card"></div>
      <div class="rv-skel-card"></div>
      <div class="rv-skel-card"></div>
      <div class="rv-skel-card"></div>
    </div>
  )}

  <div class="rv-target" data-rv-block={block}></div>
</section>

<style>
  .rv-wrap {
    position: relative;
    width: 100%;
  }
  .rv-skel-grid {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 14px;
    margin-top: 12px;
  }
  .rv-skel-card {
    height: 220px;
    border-radius: 12px;
    background: linear-gradient(90deg, #f4f4f4 25%, #ececec 37%, #f4f4f4 63%);
    background-size: 400% 100%;
    animation: shimmer 1.4s infinite linear;
  }
  @keyframes shimmer {
    0% { background-position: 100% 0 }
    100% { background-position: -100% 0 }
  }
  @media (max-width: 1100px) {
    .rv-skel-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
  }
  @media (max-width: 800px) {
    .rv-skel-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
  }
  @media (max-width: 520px) {
    .rv-skel-grid { grid-template-columns: 1fr; }
  }
</style>

<script>
  (function(){
    if (!window.RealtyVis) {
      const s = document.createElement("script");
      s.src = "https://cdn.realtyvis.com/js/embed.js";
      s.async = true;
      s.onload = () => {
        try {
          window.RealtyVis?.init?.();
          window.RealtyVis?.scan?.();
        } catch(e){ console.error("[RVEmbed] init error", e); }
      };
      s.onerror = (e) => console.error("[RVEmbed] script load failed", e);
      document.head.appendChild(s);
    } else {
      try {
        window.RealtyVis?.scan?.();
      } catch(e){ console.error("[RVEmbed] scan error", e); }
    }
  })();
</script>
