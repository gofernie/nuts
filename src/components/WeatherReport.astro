---
/**
 * WeatherReport.astro (wttr.in version)
 * âœ… No API key required
 * ðŸŒ¤ Current + 3-day forecast
 * Props:
 *  - city (string) defaults to "Fernie"
 *  - title (string) defaults to "Weather"
 */
const {
  city = "Fernie",
  title = "Weather",
} = Astro.props;
---

<div class="wx-card" data-city={city}>
  <div class="wx-header">{title}</div>
  <div class="wx-now">
    <div class="wx-now-temp"><span class="temp">â€“</span><span class="unit">Â°C</span></div>
    <div class="wx-now-meta"><span class="winds">Wind â€“</span> â€¢ <span class="precip">Precip â€“</span></div>
  </div>
  <div class="wx-daily"></div>
  <small class="wx-note">wttr.in â€¢ {city}</small>
</div>

<script is:inline>
  (function(){
    const card = document.currentScript.previousElementSibling;
    const city = card.getAttribute('data-city');

    fetch(`https://wttr.in/${encodeURIComponent(city)}?format=j1`)
      .then(r=>r.json())
      .then(data=>{
        const $ = (s)=>card.querySelector(s);
        const current = data.current_condition?.[0];
        if(!current) return;

        // Current conditions
        $(".temp").textContent = current.temp_C;
        $(".winds").textContent = `Wind ${current.windspeedKmph} km/h`;
        $(".precip").textContent = `Precip ${current.precipMM} mm`;

        // Daily forecast
        const days = data.weather?.slice(0,3) || [];
        $(".wx-daily").innerHTML = days.map(d=>{
          const date = d.date;
          const max = d.maxtempC;
          const min = d.mintempC;
          const snow = d.totalSnow_cm;
          const rain = d.hourly.reduce((acc,h)=> acc+Number(h.precipMM||0),0).toFixed(1);
          return `
            <div class="wx-day">
              <div class="wx-day-label">${new Date(date).toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'})}</div>
              <div class="wx-day-temps">${max}Â° / ${min}Â°</div>
              <div class="wx-day-snow">${snow} cm snow</div>
              <div class="wx-day-precip">${rain} mm precip</div>
            </div>
          `;
        }).join("");
      })
      .catch(()=>{/* silent fail */});
  })();
</script>

<style>
  .wx-card { border:1px solid #eee; border-radius:12px; padding:16px; background:#fff; box-shadow:0 1px 3px rgba(0,0,0,0.05); }
  .wx-header { font-weight:700; margin-bottom:8px; }
  .wx-now { display:flex; align-items:baseline; gap:16px; margin-bottom:12px; }
  .wx-now-temp { font-size:2rem; font-weight:800; }
  .wx-now-temp .unit { font-size:1rem; opacity:.8; margin-left:2px; }
  .wx-now-meta { color:#555; }
  .wx-daily { display:grid; grid-template-columns: repeat(auto-fit, minmax(160px,1fr)); gap:10px; margin-top:8px; }
  .wx-day { border:1px solid #f1f1f1; border-radius:10px; padding:10px; background:#fafafa; }
  .wx-day-label { font-weight:700; margin-bottom:4px; }
  .wx-note { display:block; margin-top:8px; color:#777; font-size:.75rem; }
</style>
